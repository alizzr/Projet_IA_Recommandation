services:
  # --- API GATEWAY (Le Chef d'orchestre) ---
  gateway:
    image: nginx:alpine
    volumes:
      - ./api_gateway/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80" # On passe sur le port standard 80
    depends_on:
      - front_user
      - front_product
      - front_ai
      - user_service
      - product_service
      - recommendation_service

  # ==============================================
  # ðŸ‘¤ DOMAINE UTILISATEUR (Vertical Slice)
  # ==============================================
  user_service: # BACKEND
    build: ./user_service
    volumes:
      - ./user_service/instance:/app/instance
    
  front_user:   # FRONTEND (Login, Register, Profile)
    build: ./user_service/frontend
    environment:
      - REACT_APP_API_URL=/api/users

  # ==============================================
  # ðŸ›’ DOMAINE PRODUIT (Vertical Slice)
  # ==============================================
  product_service: # BACKEND
    build: ./product_service

  front_product:   # FRONTEND (Catalogue)
    build: ./product_service/frontend
    environment:
      - REACT_APP_API_URL=/api/products

  # ==============================================
  # ðŸ§  DOMAINE INTELLIGENCE (Vertical Slice)
  # ==============================================
  recommendation_service: # BACKEND
    build: ./recommendation_service

  front_ai:        # FRONTEND (Formulaire IA)
    build: ./recommendation_service/frontend
    environment:
      - REACT_APP_API_URL=/api/ai

networks:
  default:
    driver: bridge